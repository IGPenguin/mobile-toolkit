#!/bin/bash
#get app package name
app=$(adb shell dumpsys window windows | grep mCurrentFocus | cut -d'/' -f1 | rev | cut -d' ' -f1 | rev)

#check if display is on
if ! [[ $app == *"com"* ]]; then
   echo "No suitable app in foreground! Aborting...";
   exit
fi

#lock screen
task_id=$(adb shell dumpsys activity | grep mFocusedActivity | rev) #get focused activity info and reverse it
set $task_id #breaks task_id into $1 $2 ...
task_id=$1 #saves $1 into task_id
task_id=$(echo $task_id | rev) # reverse string back
task_id=${task_id//[!0-9]/} #strip non numeric chars from task_id
adb shell am task lock $task_id;

#!!!!
#SEM DODAT POTVRZENI ZAMCENI
#!!!!

#run test
echo
echo "Running app stress test."
echo "Package name: "$app
adb shell monkey -p $app -v1 --pct-syskeys 0 100

#unlock screen
adb shell am task lock stop


