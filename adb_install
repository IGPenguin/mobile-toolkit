#!/bin/bash
location=$(dirname "$0")
source $location/common_tools
android_choose_device

if [ -z "$1" ] ; then
  echo "ðŸ¤·â€ What should I install?"
  exit
fi

#get package name from .apk
echo "ðŸ” Detecting package name..."
AAPPT_PATH=$(find $ANDROID_HOME -name 'aapt' | sort | tail -1)
PACKAGE_NAME=$($AAPPT_PATH dump badging $1 | grep package:\ name);
PACKAGE_NAME=$(echo $PACKAGE_NAME | sed 's/^[^'\'']*'\''//');
PACKAGE_NAME=$(echo $PACKAGE_NAME | sed 's/'\''.*//');

echo "âŒ›ï¸ Installing $PACKAGE_NAME"
adb -s $SELECTED_DEVICE install -r $1 &> /dev/null
if [ $? -eq 0 ] ; then #does not work, exit code is 0 after failure :/
  echo "ðŸš€ Launching..."
  adb -s $SELECTED_DEVICE shell monkey -p $PACKAGE_NAME -c android.intent.category.LAUNCHER 1 &> /dev/null
else
  echo "ðŸ’¥ Installation failed, nothing to launch!"
fi
