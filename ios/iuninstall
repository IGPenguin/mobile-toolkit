#!/bin/bash
LOCATION=$(dirname "$0")
source $LOCATION/../common_tools
ios_choose_device

UNINSTALL_COUNT=0
ios_get_package_list

if [[  "$1" == "-a" ]]; then
  tput setaf 1
  should_proceed "ðŸ’£ Delete all third party apps on $SELECTED_DEVICE_MODEL - $SELECTED_DEVICE?"
  tput sgr0
  for PKG in "${PACKAGE_LIST[@]}"
  do
    if [[ $PKG = *"funtaster"* ]] || [[ $PKG = *"com.apple.TestFlight"* ]] || [[ $PKG = *"sketch"* ]] || [[ $PKG = *"figma"* ]] || [[ $PKG = *"framer"* ]] || [[ $PKG = *"invision"* ]]; then
      echo "â© Skipping $PKG"
      continue
    fi
    echo "ðŸ”¥ Uninstalling $PKG"
    ideviceinstaller -u $SELECTED_DEVICE -U $PKG &> /dev/null
    ((++UNINSTALL_COUNT))
  done
  echo "âœ… Apps uninstalled: $UNINSTALL_COUNT"
  exit
elif [[ -n "$1" ]]; then
  PACKAGE=$1
  echo $PACKAGE_LIST | grep -w "$PACKAGE" &> /dev/null || { echo "ðŸ¤·â€ Package \"$PACKAGE\" not installed"; exit; }
fi

if [ -z "$PACKAGE" ]; then
  if [ ${#PACKAGE_LIST[@]} -eq 0 ]; then
      echo "ðŸ¤·â€ Nothing to uninstall"
      exit
  fi

  echo "ðŸ“‹ Choose package number:"
  select OPTION in "${PACKAGE_LIST[@]}"
  do
   case $OPTION in
      *) PACKAGE=$OPTION;break; ;;
    esac
  done
fi

echo "ðŸ”¥ Uninstalling $PACKAGE"
ideviceinstaller -u $SELECTED_DEVICE -U $PACKAGE &> /dev/null
echo "âœ… Done"
