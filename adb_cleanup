#!/bin/bash
LOCATION=$(dirname "$0")
source $LOCATION/common_tools
android_choose_device

read -r -p "🔥 Do you really want to remove ALL third party packages and wipe /sdcard/Download on $SELECTED_DEVICE_MODEL? [y/n] " response
case "$response" in
    [yY])
        ;;
    *)
        exit
        ;;
esac

IFS=$'\n'
packages=($(adb -s $SELECTED_DEVICE shell 'pm list packages -3 -f' | sed -e 's/.*=//' | sort))
unset IFS

for pkg in "${packages[@]}"
do

   if [[ $pkg = *"funtaster"* ]] || [[ $pkg = *"io.crash.air"* ]] || [[ $pkg = *"de.codenauts.hockeyapp"* ]] || [[ $pkg = *"chrome"* ]]; then
      echo "⏭ Skipping $pkg"
      continue
   fi

   pkg=${pkg%$'\r'} #removes trailing \r
   echo "🗑 Uninstalling $pkg"
   adb -s $SELECTED_DEVICE shell "pm uninstall $pkg" &> /dev/null

done

echo "🗑 Clearing /sdcard/Download"
adb -s $SELECTED_DEVICE shell rm -r /sdcard/Download/*
