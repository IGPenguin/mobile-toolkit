#!/bin/bash
LOCATION=$(dirname "$0")
source "$LOCATION"/../common_tools
trap "kill 0" SIGINT # Kill all spawned subprocesses on ctrl^c

android_choose_device

RUNNING_TESTS=false;
trap 'ctrlc' 1 2 3 6 15

ctrlc(){
  if $RUNNING_TESTS; then
    adb -s "$SELECTED_DEVICE" shell ps | awk '/com\.android\.commands\.monkey/ { system("adb shell kill " $2) }' >/dev/null 2>&1
    echo "ðŸ™ˆ Monkey eliminated, device is safe to use again"

    adb shell am task lock stop >/dev/null 2>&1
    echo "ðŸ”“ App fullscreen mode disabled"
  fi
  exit 2
}

android_unlock_screen_attempt 3
